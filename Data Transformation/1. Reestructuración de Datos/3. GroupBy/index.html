
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://sitename.example/Data%20Transformation/1.%20Reestructuraci%C3%B3n%20de%20Datos/3.%20GroupBy/">
      
      
        <link rel="prev" href="../2.%20Unpivot/">
      
      
        <link rel="next" href="../../2.%20Combining%20Data/1.%20Appending/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>3. GroupBy - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 12a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M6 13h8l-3.5 3.5 1.42 1.42L17.84 12l-5.92-5.92L10.5 7.5 14 11H6z"/></svg>');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRed+Hat+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Red Hat Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#agregacion" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3. GroupBy
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  ¡Bienvenido!

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../admonition/" class="md-tabs__link">
        
  
    
  
  Admonition

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../example/" class="md-tabs__link">
        
  
    
  
  Example

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../mermaid/" class="md-tabs__link">
        
  
    
  
  Mermaid

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../tabs/" class="md-tabs__link">
        
  
    
  
  Tabs

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Data%20Modeling/Definicion%20de%20Tablas/" class="md-tabs__link">
          
  
    
  
  Data Modeling

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../1.%20Pivot/" class="md-tabs__link">
          
  
    
  
  Data Transformation

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../EDA/Importancia%20del%20EDA/1.%20Consideraciones/" class="md-tabs__link">
          
  
    
  
  EDA

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Introducci%C3%B3n%20a%20Gesti%C3%B3n%20de%20Riesgo%20Python/1.%20Riesgo%20y%20Rentabilidad/" class="md-tabs__link">
          
  
    
  
  Introducción a Gestión de Riesgo Python

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Proyectos/Marketing%20Analytics/Introducci%C3%B3n/" class="md-tabs__link">
          
  
    
  
  Proyectos

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../blog/" class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ¡Bienvenido!
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../admonition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Admonition
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mermaid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mermaid
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tabs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tabs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data Modeling
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Data Modeling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Data%20Modeling/Definicion%20de%20Tablas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Definicion de Tablas
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Data Transformation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Data Transformation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" checked>
        
          
          <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    1. Reestructuración de Datos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            1. Reestructuración de Datos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.%20Pivot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Pivot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.%20Unpivot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Unpivot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    3. GroupBy
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    3. GroupBy
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#agregacion" class="md-nav__link">
    <span class="md-ellipsis">
      Agregación
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Agregación">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sintaxis" class="md-nav__link">
    <span class="md-ellipsis">
      Sintáxis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplos" class="md-nav__link">
    <span class="md-ellipsis">
      Ejemplos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformacion" class="md-nav__link">
    <span class="md-ellipsis">
      Transformación
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transformación">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sintaxis_1" class="md-nav__link">
    <span class="md-ellipsis">
      Sintáxis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplos_1" class="md-nav__link">
    <span class="md-ellipsis">
      Ejemplos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filtrado" class="md-nav__link">
    <span class="md-ellipsis">
      Filtrado
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Filtrado">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sintaxis_2" class="md-nav__link">
    <span class="md-ellipsis">
      Sintaxis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplos_2" class="md-nav__link">
    <span class="md-ellipsis">
      Ejemplos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    2. Combining Data
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            2. Combining Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2.%20Combining%20Data/1.%20Appending/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Appending
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2.%20Combining%20Data/2.%20Merging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Merging
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    3. Custom Columns
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            3. Custom Columns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3.%20Custom%20Columns/1.%20Ranking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Ranking
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    EDA
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            EDA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Importancia del EDA
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            Importancia del EDA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EDA/Importancia%20del%20EDA/1.%20Consideraciones/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Consideraciones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EDA/Importancia%20del%20EDA/2.%20Creaci%C3%B3n%20de%20Features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Creación de Features
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Limpieza e Imputación de datos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            Limpieza e Imputación de datos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EDA/Limpieza%20e%20Imputaci%C3%B3n%20de%20datos/1.%20Valores%20nulos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Valores nulos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EDA/Limpieza%20e%20Imputaci%C3%B3n%20de%20datos/2.%20Datos%20Categ%C3%B3ricos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Datos Categóricos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EDA/Limpieza%20e%20Imputaci%C3%B3n%20de%20datos/3.%20Datos%20Num%C3%A9ricos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Datos Numéricos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EDA/Limpieza%20e%20Imputaci%C3%B3n%20de%20datos/4.%20Valores%20at%C3%ADpicos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Valores atípicos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EDA/Limpieza%20e%20Imputaci%C3%B3n%20de%20datos/Valores%20nulos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Valores nulos
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Trabajando con Tiempo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            Trabajando con Tiempo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EDA/Trabajando%20con%20Tiempo/1.%20Patr%C3%B3n%20a%20largo%20del%20tiempo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Patrón a largo del tiempo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EDA/Trabajando%20con%20Tiempo/2.%20Correlaci%C3%B3n/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Correlación
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EDA/Trabajando%20con%20Tiempo/3.%20Relaci%C3%B3n%20y%20Distribuci%C3%B3n%20Datos%20Categ%C3%B3ricos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Relación y Distribución Datos Categóricos
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Introducción a Gestión de Riesgo Python
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Introducción a Gestión de Riesgo Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Introducci%C3%B3n%20a%20Gesti%C3%B3n%20de%20Riesgo%20Python/1.%20Riesgo%20y%20Rentabilidad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Riesgo y Rentabilidad
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Introducci%C3%B3n%20a%20Gesti%C3%B3n%20de%20Riesgo%20Python/2.%20Media.%20Varianza%20y%20Distribuci%C3%B3n%20Normal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Media. Varianza y Distribución Normal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Introducci%C3%B3n%20a%20Gesti%C3%B3n%20de%20Riesgo%20Python/3.%20Skewness%20y%20Kurtosis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Skewness y Kurtosis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Introducci%C3%B3n%20a%20Gesti%C3%B3n%20de%20Riesgo%20Python/4.%20Hip%C3%B3tesis%20para%20Distribuci%C3%B3n%20Normal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Hipótesis para Distribución Normal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_5" >
        
          
          <label class="md-nav__link" for="__nav_9_5" id="__nav_9_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cartera de Inversión
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_5">
            <span class="md-nav__icon md-icon"></span>
            Cartera de Inversión
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Introducci%C3%B3n%20a%20Gesti%C3%B3n%20de%20Riesgo%20Python/Cartera%20de%20Inversi%C3%B3n/1.%20Composici%C3%B3n%20de%20Cartera%20y%20Backtesting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Composición de Cartera y Backtesting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Introducci%C3%B3n%20a%20Gesti%C3%B3n%20de%20Riesgo%20Python/Cartera%20de%20Inversi%C3%B3n/2.%20Correlaci%C3%B3n%20y%20covarianza/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Correlación y covarianza
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Introducci%C3%B3n%20a%20Gesti%C3%B3n%20de%20Riesgo%20Python/Cartera%20de%20Inversi%C3%B3n/3.%20Portafolio%20Markowitz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Portafolio Markowitz
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_6" >
        
          
          <label class="md-nav__link" for="__nav_9_6" id="__nav_9_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Inversión Factorial
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_6">
            <span class="md-nav__icon md-icon"></span>
            Inversión Factorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Introducci%C3%B3n%20a%20Gesti%C3%B3n%20de%20Riesgo%20Python/Inversi%C3%B3n%20Factorial/1.%20CAPM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. CAPM
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Proyectos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Proyectos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_1" >
        
          
          <label class="md-nav__link" for="__nav_10_1" id="__nav_10_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Marketing Analytics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_1">
            <span class="md-nav__icon md-icon"></span>
            Marketing Analytics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Proyectos/Marketing%20Analytics/Introducci%C3%B3n/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introducción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_1_2" >
        
          
          <label class="md-nav__link" for="__nav_10_1_2" id="__nav_10_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Etapa II   Python
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_10_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_1_2">
            <span class="md-nav__icon md-icon"></span>
            Etapa II   Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Proyectos/Marketing%20Analytics/Etapa%20II%20-%20Python/An%C3%A1lisis%20de%20Sentimiento/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Análisis de Sentimiento
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_1_3" >
        
          
          <label class="md-nav__link" for="__nav_10_1_3" id="__nav_10_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Etapada 1. SQL
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_10_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_1_3">
            <span class="md-nav__icon md-icon"></span>
            Etapada 1. SQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Proyectos/Marketing%20Analytics/Etapada%201.%20SQL/Limpieza/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Limpieza
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../blog/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_11" id="__nav_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Archive
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#agregacion" class="md-nav__link">
    <span class="md-ellipsis">
      Agregación
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Agregación">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sintaxis" class="md-nav__link">
    <span class="md-ellipsis">
      Sintáxis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplos" class="md-nav__link">
    <span class="md-ellipsis">
      Ejemplos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformacion" class="md-nav__link">
    <span class="md-ellipsis">
      Transformación
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transformación">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sintaxis_1" class="md-nav__link">
    <span class="md-ellipsis">
      Sintáxis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplos_1" class="md-nav__link">
    <span class="md-ellipsis">
      Ejemplos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filtrado" class="md-nav__link">
    <span class="md-ellipsis">
      Filtrado
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Filtrado">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sintaxis_2" class="md-nav__link">
    <span class="md-ellipsis">
      Sintaxis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplos_2" class="md-nav__link">
    <span class="md-ellipsis">
      Ejemplos
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>3. GroupBy</h1>

<p>Es la agrupación de datos basado en una o más columnas y calcular métricas resumidas mediante una función de agregación.
El uso del <code>groupby</code> tiene tres finalidades los cuales son:
* Agregación
* Transformación
* Filtro</p>
<p>Pudiendo ser útil en una fase inicial del análisis exploratorio hasta un análisis avanzado.</p>
<p>Tenemos que saber cuando aplicamos solo <code>.groupby("column_name)</code> en Python, lo que hacemos es agrupar toda la tabla a través de su columna</p>
<h2 id="agregacion">Agregación<a class="headerlink" href="#agregacion" title="Permanent link">&para;</a></h2>
<p>Permite calcular estadísitcas resumidas (suma, promedio, conteo,  máximo, etc.) para cada grupo.</p>
<h3 id="sintaxis">Sintáxis<a class="headerlink" href="#sintaxis" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="sintaxis-pandas" name="__tabbed_1" type="radio" /><input id="sintaxis-polars" name="__tabbed_1" type="radio" /><input id="sintaxis-sql-server" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="sintaxis-pandas">Pandas</label><label for="sintaxis-polars">Polars</label><label for="sintaxis-sql-server">SQL Server</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">dataframe</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;column&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1">#(1)!</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">dataframe</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;column&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span> <span class="c1">#(2)!</span>
</span></code></pre></div>
<ol>
<li><code>sum()</code> es una de las funciones de agregación, pero pueden ser otras: <code>mean()</code>, <code>max()</code>, <code>count()</code> etc.</li>
<li>
<ul>
<li><code>func</code> hace referencia a funciones de agregación o funciones propias.</li>
<li><code>engine</code> hace referenia a el uso del motor de cálculo, puedo ser <strong>cpython</strong> o <strong>numba</strong>, por defecto se elige la más óptima (cpython).</li>
</ul>
</li>
</ol>
</div>
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">dataframe</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s1">&#39;column&#39;</span><span class="p">,</span> <span class="n">maintain_order</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>            <span class="p">(</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>            <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;values&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">aggfunc</span><span class="p">()</span> <span class="o">|</span> <span class="n">pl</span><span class="o">.</span><span class="n">aggfunc</span><span class="p">(</span><span class="s1">&#39;values&#39;</span><span class="p">)</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>            <span class="p">)</span> <span class="c1">#(1)!</span>
</span></code></pre></div>
<ol>
<li>
<p>En Polars solo hay una forma de hacer un groupby, es mediante el método <code>agg()</code>, hay dos formas de llamar a sus argumentos:</p>
<ul>
<li><code>pl.col('values').aggfunc()</code>: Se indica la columna <code>values</code> y se le aplica una función de transformación (<code>sum()</code>, mean()<code>,</code>max()<code>,</code>len(), etc.)</li>
<li><code>pl.aggfunc('values')</code>: Este es más corto, se llama a la función de agregación indicando a la columna.</li>
</ul>
<div class="admonition success">
<p class="admonition-title">Diferencias</p>
<p>La principal diferencia entre ambas formas es que la primera (<code>pl.col('values').aggfunc()</code>) permite realizar una transformación previa a aplicar una transformación de agregación, un pequeño ejemplo sería <code class="language-py highlight"><span class="n">DataFrame</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;cliente&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">((</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;costo&#39;</span><span class="p">)</span><span class="o">*</span><span class="mf">1.18</span><span class="p">)</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span></code></p>
</div>
</li>
</ol>
</div>
<div class="tabbed-block">
<div class="language-sql highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="s1">&#39;columna_fija&#39;</span><span class="p">,</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="p">[</span><span class="n">val1</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">val2</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">valn</span><span class="p">]</span><span class="w">  </span><span class="c1">-- Valores distintos de la columna pivot</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;columna_fija&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;columna_pivot&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;valor&#39;</span><span class="w"> </span><span class="k">FROM</span><span class="w">  </span><span class="n">tabla_original</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">tabla_intermedia</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="n">PIVOT</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="p">(</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="n">aggfunc</span><span class="p">(</span><span class="s1">&#39;valor&#39;</span><span class="p">)</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">    </span><span class="k">FOR</span><span class="w"> </span><span class="s1">&#39;columna_pivot&#39;</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">([</span><span class="n">val1</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">val2</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">valn</span><span class="p">])</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">tabla_pivoteada</span>
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="ejemplos">Ejemplos<a class="headerlink" href="#ejemplos" title="Permanent link">&para;</a></h3>
<p>Para estos ejemplos se utilizará la tabla siguiente, que indica las deudas de los clientes.</p>
<table>
<thead>
<tr>
<th>cliente</th>
<th>producto</th>
<th>monto</th>
<th>estado_mora</th>
<th>periodo</th>
</tr>
</thead>
<tbody>
<tr>
<td>C001</td>
<td>Prestamo</td>
<td>15000.00</td>
<td>Al dia</td>
<td>2023-Q1</td>
</tr>
<tr>
<td>C002</td>
<td>Tarjeta</td>
<td>2000.00</td>
<td>En mora</td>
<td>2023-Q1</td>
</tr>
<tr>
<td>C003</td>
<td>Prestamo</td>
<td>12000.00</td>
<td>Al dia</td>
<td>2023-Q1</td>
</tr>
<tr>
<td>C001</td>
<td>Tarjeta</td>
<td>2500.00</td>
<td>Al dia</td>
<td>2023-Q2</td>
</tr>
<tr>
<td>C004</td>
<td>Prestamo</td>
<td>18000.00</td>
<td>En mora</td>
<td>2023-Q2</td>
</tr>
<tr>
<td>C005</td>
<td>Tarjeta</td>
<td>3000.00</td>
<td>Al dia</td>
<td>2023-Q2</td>
</tr>
<tr>
<td>C002</td>
<td>Prestamo</td>
<td>10000.00</td>
<td>En mora</td>
<td>2023-Q3</td>
</tr>
<tr>
<td>C003</td>
<td>Tarjeta</td>
<td>4000.00</td>
<td>En mora</td>
<td>2023-Q3</td>
</tr>
<tr>
<td>C004</td>
<td>Prestamo</td>
<td>15000.00</td>
<td>Al dia</td>
<td>2023-Q3</td>
</tr>
<tr>
<td>C005</td>
<td>Prestamo</td>
<td>22000.00</td>
<td>En mora</td>
<td>2023-Q4</td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Ejemplos de uso de función de agregación</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:3"><input checked="checked" id="ejemplos-pandas" name="__tabbed_2" type="radio" /><input id="ejemplos-polars" name="__tabbed_2" type="radio" /><input id="ejemplos-sql-server" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="ejemplos-pandas">Pandas</label><label for="ejemplos-polars">Polars</label><label for="ejemplos-sql-server">SQL Server</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cliente&quot;</span><span class="p">)[</span><span class="s2">&quot;monto&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span> <span class="c1">#(1)!</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cliente&quot;</span><span class="p">)[</span><span class="s2">&quot;monto&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span> <span class="c1">#(2)!</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cliente&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span class="s2">&quot;monto&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">]</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    <span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span> <span class="c1">#(3)!</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cliente&quot;</span><span class="p">)[</span><span class="s2">&quot;monto&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>        <span class="p">[</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>            <span class="p">(</span><span class="s2">&quot;Calculos&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">]),</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>            <span class="p">(</span><span class="s2">&quot;Cantidad Total&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">)</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>         <span class="p">])</span> <span class="c1">#(4)!</span>
</span></code></pre></div>
<ol>
<li>
<p>Calculo simple, se reseta el índice (cliente) para que sea una columna</p>
<table>
<thead>
<tr>
<th></th>
<th>cliente</th>
<th>monto</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>C001</td>
<td>17500</td>
</tr>
<tr>
<td>1</td>
<td>C002</td>
<td>12000</td>
</tr>
<tr>
<td>2</td>
<td>C003</td>
<td>16000</td>
</tr>
<tr>
<td>3</td>
<td>C004</td>
<td>33000</td>
</tr>
<tr>
<td>4</td>
<td>C005</td>
<td>25000</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Múltiples cálculos</p>
<table>
<thead>
<tr>
<th></th>
<th>cliente</th>
<th>sum</th>
<th>mean</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>C001</td>
<td>17500</td>
<td>8750.0</td>
</tr>
<tr>
<td>1</td>
<td>C002</td>
<td>12000</td>
<td>6000.0</td>
</tr>
<tr>
<td>2</td>
<td>C003</td>
<td>16000</td>
<td>8000.0</td>
</tr>
<tr>
<td>3</td>
<td>C004</td>
<td>33000</td>
<td>16500.0</td>
</tr>
<tr>
<td>4</td>
<td>C005</td>
<td>25000</td>
<td>12500.0</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Cálculos múltiples, pero reserva el nombre de la columna a la cual se le aplica la agregación, en este caso es "monto".</p>
<p><style>
    table {
    width: 100%;
    border-collapse: collapse;
    }
    th, td {
    border: 1px solid black;
    padding: 8px;
    text-align: center;
    }
    th {
        font-weight: bold;
    }
    /* Clase para centrar texto */
    .centrar-texto {
    text-align: center;
    }
</style></p>
<p><table>
    <thead>
        <tr>
        <th rowspan="2">cliente</th>
        <th colspan="3" class="centrar-texto">monto</th>
        </tr>
        <tr>
        <th>sum</th>
        <th>mean</th>
        <th>count</th>
        </tr>
    </thead>
    <tbody>
        <tr>
        <td>C001</td>
        <td>17500</td>
        <td>8750.0</td>
        <td>2</td>
        </tr>
        <tr>
        <td>C002</td>
        <td>12000</td>
        <td>6000.0</td>
        <td>2</td>
        </tr>
        <tr>
        <td>C003</td>
        <td>16000</td>
        <td>8000.0</td>
        <td>2</td>
        </tr>
        <tr>
        <td>C004</td>
        <td>33000</td>
        <td>16500.0</td>
        <td>2</td>
        </tr>
        <tr>
        <td>C005</td>
        <td>25000</td>
        <td>12500.0</td>
        <td>2</td>
        </tr>
    </tbody>
</table></p>
</li>
<li>
<p>En este caso, se indica primero la columna y luego podemos darle un "alias" a las columnas nuevas.</p>
<p><table>
    <thead>
        <tr>
        <th rowspan="2">cliente</th>
        <th colspan="2">Calculos</th>
        <th colspan="1">Cantidad Total</th>
        </tr>
        <tr>
        <th class="centrar-texto">sum</th>
        <th class="centrar-texto">mean</th>
        <th class="centrar-texto">monto</th>
        </tr>
    </thead>
    <tbody>
        <tr>
        <td>C001</td>
        <td class="centrar-texto">17500</td>
        <td class="centrar-texto">8750.0</td>
        <td class="centrar-texto">2</td>
        </tr>
        <tr>
        <td>C002</td>
        <td class="centrar-texto">12000</td>
        <td class="centrar-texto">6000.0</td>
        <td class="centrar-texto">2</td>
        </tr>
        <tr>
        <td>C003</td>
        <td class="centrar-texto">16000</td>
        <td class="centrar-texto">8000.0</td>
        <td class="centrar-texto">2</td>
        </tr>
        <tr>
        <td>C004</td>
        <td class="centrar-texto">33000</td>
        <td class="centrar-texto">16500.0</td>
        <td class="centrar-texto">2</td>
        </tr>
        <tr>
        <td>C005</td>
        <td class="centrar-texto">25000</td>
        <td class="centrar-texto">12500.0</td>
        <td class="centrar-texto">2</td>
        </tr>
    </tbody>
</table></p>
</li>
</ol>
</div>
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>    <span class="n">dl</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s2">&quot;cliente&quot;</span><span class="p">,</span> <span class="n">maintain_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>        <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;monto&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Monto total&quot;</span><span class="p">),</span> 
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>        <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;monto&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Monto promedio&quot;</span><span class="p">)</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="p">])</span> <span class="c1">#(1)!</span>
</span></code></pre></div>
<ol>
<li>
<p>Podemos ver la gran facilidad de realizar un <code>group_by</code> a diferencia de pandas.</p>
<table>
<thead>
<tr>
<th>cliente</th>
<th>Monto</th>
<th>total Monto promedio</th>
</tr>
</thead>
<tbody>
<tr>
<td>str</td>
<td>i64</td>
<td>f64</td>
</tr>
<tr>
<td>"C001"</td>
<td>17500</td>
<td>8750.0</td>
</tr>
<tr>
<td>"C002"</td>
<td>12000</td>
<td>6000.0</td>
</tr>
<tr>
<td>"C003"</td>
<td>16000</td>
<td>8000.0</td>
</tr>
<tr>
<td>"C004"</td>
<td>33000</td>
<td>16500.0</td>
</tr>
<tr>
<td>"C005"</td>
<td>25000</td>
<td>12500.0</td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
<div class="tabbed-block">
<div class="language-sql highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">        </span><span class="n">cliente</span><span class="p">,</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">monto</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;Monto Total&#39;</span><span class="p">,</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">        </span><span class="k">AVG</span><span class="p">(</span><span class="n">monto</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;Monto Promedio&#39;</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">historial_crediticio</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">cliente</span><span class="p">;</span><span class="w"> </span><span class="c1">--(1)!</span>
</span></code></pre></div>
<ol>
<li>
<p>Si bien en SQL no es obligatorio poner alias a las columnas, es una buena práctica. Se puede también notar su fácil declaración.</p>
<table>
<thead>
<tr>
<th>cliente</th>
<th>Monto Total</th>
<th>Monto Promedio</th>
</tr>
</thead>
<tbody>
<tr>
<td>C001</td>
<td>17500.00</td>
<td>8750.00</td>
</tr>
<tr>
<td>C002</td>
<td>12000.00</td>
<td>6000.00</td>
</tr>
<tr>
<td>C003</td>
<td>16000.00</td>
<td>8000.00</td>
</tr>
<tr>
<td>C004</td>
<td>33000.00</td>
<td>16500.00</td>
</tr>
<tr>
<td>C005</td>
<td>25000.00</td>
<td>12500.00</td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="admonition success">
<p class="admonition-title">Importante</p>
<p>En <strong>Polars</strong> es <strong>obligatorio colocar las alias de las nuevas columnas de agregación</strong> cuando se aplica a una misma columna (valor), si no se coloca se obtiene un error <code>DuplicateError</code></p>
</div>
<h2 id="transformacion">Transformación<a class="headerlink" href="#transformacion" title="Permanent link">&para;</a></h2>
<p>En transformación se aplica funciones sobre cada grupo, devolviendo un objeto del mismo tamaña de la tabla original (sin agrupar), transforma los datos pero manteniendo la estructura. Suele usarse como normalización de los datos.</p>
<h3 id="sintaxis_1">Sintáxis<a class="headerlink" href="#sintaxis_1" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="3:3"><input checked="checked" id="sintaxis_1-pandas" name="__tabbed_3" type="radio" /><input id="sintaxis_1-polars" name="__tabbed_3" type="radio" /><input id="sintaxis_1-sql-server" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="sintaxis_1-pandas">Pandas</label><label for="sintaxis_1-polars">Polars</label><label for="sintaxis_1-sql-server">SQL Server</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">DataFrame</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;column&#39;</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="c1">#(1)!</span>
</span></code></pre></div>
<ol>
<li><code>func</code> hace referencia a una función de agregación (<code>"sum", "mean"</code>, "count", etc.) o una función personalizada (<code>lambda</code>). La evaluación para cada grupo y ese valor es asignado a cada uno de las filas que corresponde (tabla original sin agrupar) a cada grupo.</li>
</ol>
</div>
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">DataFrame</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="p">(</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>        <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">/</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="s2">&quot;column&quot;</span><span class="p">)</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;nombre_nuevo&quot;</span><span class="p">)</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="p">)</span> <span class="c1">#(1)!</span>
</span></code></pre></div>
<ol>
<li>En <strong>Polars</strong> no se requiere el uso de funciones <code>lambda</code>, aprovecha que su diseño de basa en vectores y usa operaciones expresivas, es más óptimo.<ul>
<li><code>with_columnas()</code>: Este método devuelve el dataframe con columna modificada o una nueva columna, evalúa todas las filas al mismo tiempo (recuerda que está basada en vectores).</li>
<li><code>pl.col("value")</code>: Se hace referencia a la columna "value", puede haber varios <code>pl.col()</code> utilizando otras columnas para realizar una transformación.</li>
<li><code>over()</code>: Over aplica operaciones calculadas sobre grupos directamente a las filas correspondiente al dataframe original.</li>
<li><code>pl.col("value").sum().over("column")</code>: La operación se realiza en una columna, se optiene la suma de cada grupo, recuerda que no necesariamente es <code>sum()</code>, puede ser también <code>mean()</code>, <code>max()</code>, etc.</li>
<li><code>alias("nombre_nuevo")</code>: Se <strong>usa <code>alias()</code>siempre y cuando querramos agregar una nueva columna</strong> con los valores calculas, si queremos modificar la columna en que hemos trabajdo, no es necesario.</li>
</ul>
</li>
</ol>
</div>
<div class="tabbed-block">
<div class="language-sql highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1">--------------------------WINDOW FUNCTIONS---------------------------</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="k">column</span><span class="p">,</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="n">value</span><span class="p">,</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="n">aggfunc</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">column</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;column_name&#39;</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span><span class="p">;</span><span class="w"> </span><span class="c1">--(1)!</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="k">GO</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="c1">--------------------------------JOIN---------------------------------</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="k">SELECT</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="k">column</span><span class="p">,</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">    </span><span class="n">cantidad</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;Mean&#39;</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">    </span><span class="k">SELECT</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">        </span><span class="n">col</span><span class="p">,</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">/</span><span class="k">COUNT</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;cantidad&#39;</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">col</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">column</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="k">column</span><span class="p">;</span><span class="w"> </span><span class="c1">--(2)!</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="k">GO</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="c1">---------------------------SUBQUERY SELECT--------------------------</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="k">SELECT</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="k">column</span><span class="p">,</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="w">    </span><span class="p">(</span><span class="k">SELECT</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">value</span><span class="p">)</span><span class="o">/</span><span class="k">COUNT</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">column</span><span class="o">=</span><span class="n">b</span><span class="p">.</span><span class="k">column</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="k">FROM</span><span class="w"> </span><span class="k">table_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"> </span><span class="c1">--(3)!</span>
</span></code></pre></div>
<ol>
<li>
<p><strong>Función Ventana</strong> <code>OVER()</code>, es el más eficiente y flexible cuando se necesita realizar agregación a nivel de grupo sin perder el contexto de las filas. Puede ser la combinación de <code>SUM() OVER()</code>, <code>AVG() OVER()</code>, <code>RANK() OVER()</code>, entre otros. <strong>Ideal para operaciones de agregación simple a dentro de grupos</strong>.</p>
</li>
<li>
<p>El uso de <code>JOIN</code> es muy buena opción si se combinará varias tablas o se necesita una agregación más compleja que no se puede hacer en <code>OVER()</code>, también es eficiente y flexible.</p>
</li>
<li>
<p>Útiles en algunos casos, pero son muy costosos para grandes datos, ya que realiza la operación fila por fila porque es una <strong>subconsulta correlacionada</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<h3 id="ejemplos_1">Ejemplos<a class="headerlink" href="#ejemplos_1" title="Permanent link">&para;</a></h3>
<div class="admonition example">
<p class="admonition-title">Monto promedio por cada cliente</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:3"><input checked="checked" id="ejemplos_1-pandas" name="__tabbed_4" type="radio" /><input id="ejemplos_1-polars" name="__tabbed_4" type="radio" /><input id="ejemplos_1-sql-server" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="ejemplos_1-pandas">Pandas</label><label for="ejemplos_1-polars">Polars</label><label for="ejemplos_1-sql-server">SQL Server</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Monto Promedio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cliente&quot;</span><span class="p">)[</span><span class="s2">&quot;monto&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;cliente&quot;</span><span class="p">)</span> <span class="c1">#(1)!</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Monto Promedio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cliente&quot;</span><span class="p">)[</span><span class="s2">&quot;monto&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="p">)</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;cliente&quot;</span><span class="p">)</span> <span class="c1">#(2)!</span>
</span></code></pre></div>
<ol>
<li>
<p>Aquí se está creando una nueva columna llamada <code>Monto Promedio</code>, este contendrá una media de por grupo. Al final, se ordena los valores respecto a la columna <code>cliente</code></p>
</li>
<li>
<p>Mediante la función <code>lambda</code> se aplica una función personalizada, muy útil cuando queremos hacer una transformación compleja, al igual que el anterior caso. se calcula la media por cada grupo. Cabe recalcar que en lambda se utiliza <code>len()</code> para hallar la cantidad, es igual a <code>"count"</code> como función de agregación.</p>
</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align: center;">cliente</th>
<th style="text-align: center;">producto</th>
<th style="text-align: center;">monto</th>
<th style="text-align: center;">estado_mora</th>
<th style="text-align: center;">periodo</th>
<th style="text-align: center;">Monto Promedio</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">C001</td>
<td style="text-align: center;">Prestamo</td>
<td style="text-align: center;">15000</td>
<td style="text-align: center;">Al dia</td>
<td style="text-align: center;">2023-Q1</td>
<td style="text-align: center;">8750.0</td>
</tr>
<tr>
<td style="text-align: center;">C001</td>
<td style="text-align: center;">Tarjeta</td>
<td style="text-align: center;">2500</td>
<td style="text-align: center;">Al dia</td>
<td style="text-align: center;">2023-Q2</td>
<td style="text-align: center;">8750.0</td>
</tr>
<tr>
<td style="text-align: center;">C002</td>
<td style="text-align: center;">Tarjeta</td>
<td style="text-align: center;">2000</td>
<td style="text-align: center;">En mora</td>
<td style="text-align: center;">2023-Q1</td>
<td style="text-align: center;">6000.0</td>
</tr>
<tr>
<td style="text-align: center;">C002</td>
<td style="text-align: center;">Prestamo</td>
<td style="text-align: center;">10000</td>
<td style="text-align: center;">En mora</td>
<td style="text-align: center;">2023-Q3</td>
<td style="text-align: center;">6000.0</td>
</tr>
<tr>
<td style="text-align: center;">C003</td>
<td style="text-align: center;">Prestamo</td>
<td style="text-align: center;">12000</td>
<td style="text-align: center;">Al dia</td>
<td style="text-align: center;">2023-Q1</td>
<td style="text-align: center;">8000.0</td>
</tr>
<tr>
<td style="text-align: center;">C003</td>
<td style="text-align: center;">Tarjeta</td>
<td style="text-align: center;">4000</td>
<td style="text-align: center;">En mora</td>
<td style="text-align: center;">2023-Q3</td>
<td style="text-align: center;">8000.0</td>
</tr>
<tr>
<td style="text-align: center;">C004</td>
<td style="text-align: center;">Prestamo</td>
<td style="text-align: center;">18000</td>
<td style="text-align: center;">En mora</td>
<td style="text-align: center;">2023-Q2</td>
<td style="text-align: center;">16500.0</td>
</tr>
<tr>
<td style="text-align: center;">C004</td>
<td style="text-align: center;">Prestamo</td>
<td style="text-align: center;">15000</td>
<td style="text-align: center;">Al dia</td>
<td style="text-align: center;">2023-Q3</td>
<td style="text-align: center;">16500.0</td>
</tr>
<tr>
<td style="text-align: center;">C005</td>
<td style="text-align: center;">Tarjeta</td>
<td style="text-align: center;">3000</td>
<td style="text-align: center;">Al dia</td>
<td style="text-align: center;">2023-Q2</td>
<td style="text-align: center;">12500.0</td>
</tr>
<tr>
<td style="text-align: center;">C005</td>
<td style="text-align: center;">Prestamo</td>
<td style="text-align: center;">22000</td>
<td style="text-align: center;">En mora</td>
<td style="text-align: center;">2023-Q4</td>
<td style="text-align: center;">12500.0</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">dl</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;monto&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="s2">&quot;cliente&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Monto Promedio&quot;</span><span class="p">)</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    <span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;cliente&quot;</span><span class="p">)</span> <span class="c1">#(1)!</span>
</span></code></pre></div>
<ol>
<li>Se calcula la media (<code>mean()</code>) sobre el grupos generados por <code>cliente</code> y se agrega una nueva columna <code>Monto Promedio</code>.</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align: center;">cliente</th>
<th style="text-align: center;">producto</th>
<th style="text-align: center;">monto</th>
<th style="text-align: center;">estado_mora</th>
<th style="text-align: center;">periodo</th>
<th style="text-align: center;">Monto Promedio</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><em>str</em></td>
<td style="text-align: center;"><em>str</em></td>
<td style="text-align: center;"><em>i64</em></td>
<td style="text-align: center;"><em>str</em></td>
<td style="text-align: center;"><em>str</em></td>
<td style="text-align: center;"><em>f64</em></td>
</tr>
<tr>
<td style="text-align: center;">"C001"</td>
<td style="text-align: center;">"Prestamo"</td>
<td style="text-align: center;">15000</td>
<td style="text-align: center;">"Al dia"</td>
<td style="text-align: center;">2023-Q1</td>
<td style="text-align: center;">8750.0</td>
</tr>
<tr>
<td style="text-align: center;">"C001"</td>
<td style="text-align: center;">"Tarjeta"</td>
<td style="text-align: center;">2500</td>
<td style="text-align: center;">"Al dia"</td>
<td style="text-align: center;">2023-Q2</td>
<td style="text-align: center;">8750.0</td>
</tr>
<tr>
<td style="text-align: center;">"C002"</td>
<td style="text-align: center;">"Tarjeta"</td>
<td style="text-align: center;">2000</td>
<td style="text-align: center;">"En mora"</td>
<td style="text-align: center;">2023-Q1</td>
<td style="text-align: center;">6000.0</td>
</tr>
<tr>
<td style="text-align: center;">"C002"</td>
<td style="text-align: center;">"Prestamo"</td>
<td style="text-align: center;">10000</td>
<td style="text-align: center;">"En mora"</td>
<td style="text-align: center;">2023-Q3</td>
<td style="text-align: center;">6000.0</td>
</tr>
<tr>
<td style="text-align: center;">"C003"</td>
<td style="text-align: center;">"Prestamo"</td>
<td style="text-align: center;">12000</td>
<td style="text-align: center;">"Al dia"</td>
<td style="text-align: center;">2023-Q1</td>
<td style="text-align: center;">8000.0</td>
</tr>
<tr>
<td style="text-align: center;">"C003"</td>
<td style="text-align: center;">"Tarjeta"</td>
<td style="text-align: center;">4000</td>
<td style="text-align: center;">"En mora"</td>
<td style="text-align: center;">2023-Q3</td>
<td style="text-align: center;">8000.0</td>
</tr>
<tr>
<td style="text-align: center;">"C004"</td>
<td style="text-align: center;">"Prestamo"</td>
<td style="text-align: center;">18000</td>
<td style="text-align: center;">"En mora"</td>
<td style="text-align: center;">2023-Q2</td>
<td style="text-align: center;">16500.0</td>
</tr>
<tr>
<td style="text-align: center;">"C004"</td>
<td style="text-align: center;">"Prestamo"</td>
<td style="text-align: center;">15000</td>
<td style="text-align: center;">"Al dia"</td>
<td style="text-align: center;">2023-Q3</td>
<td style="text-align: center;">16500.0</td>
</tr>
<tr>
<td style="text-align: center;">"C005"</td>
<td style="text-align: center;">"Tarjeta"</td>
<td style="text-align: center;">3000</td>
<td style="text-align: center;">"Al dia"</td>
<td style="text-align: center;">2023-Q2</td>
<td style="text-align: center;">12500.0</td>
</tr>
<tr>
<td style="text-align: center;">"C005"</td>
<td style="text-align: center;">"Prestamo"</td>
<td style="text-align: center;">22000</td>
<td style="text-align: center;">"En mora"</td>
<td style="text-align: center;">2023-Q4</td>
<td style="text-align: center;">12500.0</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-sql highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1">-- OVER</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="k">SELECT</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="n">cliente</span><span class="p">,</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">    </span><span class="n">monto</span><span class="p">,</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">monto</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">cliente</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">                    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;Monto Medio&#39;</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="k">FROM</span><span class="w"> </span><span class="n">historial_crediticio</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="c1">-- JOIN</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">    </span><span class="n">HC1</span><span class="p">.</span><span class="n">cliente</span><span class="p">,</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">    </span><span class="n">HC1</span><span class="p">.</span><span class="n">monto</span><span class="p">,</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">    </span><span class="n">HC2</span><span class="p">.</span><span class="n">cantidad</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;Monto Promedio&#39;</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="k">FROM</span><span class="w"> </span><span class="n">historial_crediticio</span><span class="w"> </span><span class="n">HC1</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="w">    </span><span class="k">SELECT</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">        </span><span class="n">cliente</span><span class="p">,</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">monto</span><span class="p">)</span><span class="o">/</span><span class="k">COUNT</span><span class="p">(</span><span class="n">monto</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cantidad</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">historial_crediticio</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">cliente</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="p">)</span><span class="w"> </span><span class="n">HC2</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="k">ON</span><span class="w"> </span><span class="n">HC1</span><span class="p">.</span><span class="n">cliente</span><span class="o">=</span><span class="n">HC2</span><span class="p">.</span><span class="n">cliente</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="c1">-- Subquery SELECT</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="k">SELECT</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="w">    </span><span class="n">HC1</span><span class="p">.</span><span class="n">cliente</span><span class="p">,</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="w">    </span><span class="n">HC1</span><span class="p">.</span><span class="n">monto</span><span class="p">,</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">HC2</span><span class="p">.</span><span class="n">monto</span><span class="p">)</span><span class="o">/</span><span class="k">COUNT</span><span class="p">(</span><span class="n">HC2</span><span class="p">.</span><span class="n">monto</span><span class="p">)</span>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">historial_crediticio</span><span class="w"> </span><span class="n">HC2</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">HC2</span><span class="p">.</span><span class="n">cliente</span><span class="o">=</span><span class="n">HC1</span><span class="p">.</span><span class="n">cliente</span><span class="p">)</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a><span class="k">FROM</span><span class="w"> </span><span class="n">historial_crediticio</span><span class="w"> </span><span class="n">HC1</span>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">HC1</span><span class="p">.</span><span class="n">cliente</span><span class="p">;</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: center;">cliente</th>
<th style="text-align: center;">monto</th>
<th style="text-align: center;">Monto Medio</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">C001</td>
<td style="text-align: center;">15000.00</td>
<td style="text-align: center;">8750.00</td>
</tr>
<tr>
<td style="text-align: center;">C001</td>
<td style="text-align: center;">2500.00</td>
<td style="text-align: center;">8750.00</td>
</tr>
<tr>
<td style="text-align: center;">C002</td>
<td style="text-align: center;">2000.00</td>
<td style="text-align: center;">6000.00</td>
</tr>
<tr>
<td style="text-align: center;">C002</td>
<td style="text-align: center;">10000.00</td>
<td style="text-align: center;">6000.00</td>
</tr>
<tr>
<td style="text-align: center;">C003</td>
<td style="text-align: center;">4000.00</td>
<td style="text-align: center;">8000.00</td>
</tr>
<tr>
<td style="text-align: center;">C003</td>
<td style="text-align: center;">12000.00</td>
<td style="text-align: center;">8000.00</td>
</tr>
<tr>
<td style="text-align: center;">C004</td>
<td style="text-align: center;">18000.00</td>
<td style="text-align: center;">16500.00</td>
</tr>
<tr>
<td style="text-align: center;">C004</td>
<td style="text-align: center;">15000.00</td>
<td style="text-align: center;">16500.00</td>
</tr>
<tr>
<td style="text-align: center;">C005</td>
<td style="text-align: center;">22000.00</td>
<td style="text-align: center;">12500.00</td>
</tr>
<tr>
<td style="text-align: center;">C005</td>
<td style="text-align: center;">3000.00</td>
<td style="text-align: center;">12500.00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">apply()</p>
<p>Este método no encaja con el significado de transformación, ya que este afecta a la estructura de los datos, pero tiene la misma casi la misma función, utiliza una función <code>lambda</code> para transformar los agrupados (no lo realiza de fila por fila).</p>
<p><code class="language-py highlight"><span class="n">DataFrame</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;column&quot;</span><span class="p">)[</span><span class="s2">&quot;valor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span></code></p>
</div>
<h2 id="filtrado">Filtrado<a class="headerlink" href="#filtrado" title="Permanent link">&para;</a></h2>
<p>El filtrado selecciona grupos que cumplen con una condición específica y elimina los que la cumplen.</p>
<h3 id="sintaxis_2">Sintaxis<a class="headerlink" href="#sintaxis_2" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="5:3"><input checked="checked" id="sintaxis_2-pandas" name="__tabbed_5" type="radio" /><input id="sintaxis_2-polars" name="__tabbed_5" type="radio" /><input id="sintaxis_2-sql-server" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="sintaxis_2-pandas">Pandas</label><label for="sintaxis_2-polars">Polars</label><label for="sintaxis_2-sql-server">SQL Server</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">DataFrame</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;column&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="p">)</span> <span class="c1">#(1)!</span>
</span></code></pre></div>
<ol>
<li>El método <code>filter()</code> tiene como parámetro una función lambda, el cuál evalua en cada grupo (<code>groupby("column")</code>) la condición (<code>&lt;condition&gt;</code>), devolviendo solo los que llegan a cumplir.</li>
</ol>
</div>
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">DataFrame</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s2">&quot;column&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">aggfunc</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;nombre_column&quot;</span><span class="p">)</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;nombre_column&quot;</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span><span class="p">)</span> <span class="c1">#(1)!</span>
</span></code></pre></div>
<ol>
<li>Se agrupa los datos a través de <code>column</code>, mediante una función de agregación y se le coloca un nombre a esa nueva columna (<code>nombre_column</code>), mediante el método <code>filter</code> que toma como parámetro a la nueva columna creada, se le aplica una condición.</li>
</ol>
</div>
<div class="tabbed-block">
<div class="language-sql highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">WITH</span><span class="w"> </span><span class="n">tabla_agrupada</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="k">SELECT</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">        </span><span class="k">column</span><span class="p">,</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">        </span><span class="n">value</span><span class="p">,</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">        </span><span class="p">...</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">...</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">tabla</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="p">)</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tabla_agrupada</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="k">WHERE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">--(1)!</span>
</span></code></pre></div>
<ol>
<li>Para poder hacer filtros a los datos agrupados, si es que se utiliza <code>OVER()</code> se tiene primero que crear una tabla intermedia, esto es porque <code>OVER()</code> solo puede ser llamado en <code>SELECT</code> y <code>ORDER BY</code>, esta puede ser un <strong>CTE</strong> o una subconsulta. Para mejor legibilidad se recomienda el uso de una <strong>CTE</strong>.</li>
</ol>
</div>
</div>
</div>
<h3 id="ejemplos_2">Ejemplos<a class="headerlink" href="#ejemplos_2" title="Permanent link">&para;</a></h3>
<div class="admonition example">
<p class="admonition-title">Encontrar los clientes que tienen riesgos crediticios</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:3"><input checked="checked" id="ejemplos_2-python" name="__tabbed_6" type="radio" /><input id="ejemplos_2-polars" name="__tabbed_6" type="radio" /><input id="ejemplos_2-sql-server" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="ejemplos_2-python">Python</label><label for="ejemplos_2-polars">Polars</label><label for="ejemplos_2-sql-server">SQL Server</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">clientes_riesgo</span><span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;estado_mora&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;En mora&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cliente&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;monto&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">&gt;</span><span class="mf">13000.0</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    <span class="p">)</span> <span class="c1">#(1)!</span>
</span></code></pre></div>
<ol>
<li>Primero se filtra a los clientes que están en <code>En mora</code> respecto a sus deudas, las filas que no cumplen son eliminadas, luego se aplica un filtrado a los grupos, donde si sus deudas suman más de $/. 13000.00, son clasificados como clientes en riesgo.</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align: center;">cliente</th>
<th style="text-align: center;">producto</th>
<th style="text-align: center;">monto</th>
<th style="text-align: center;">estado_mora</th>
<th style="text-align: center;">periodo</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">C004</td>
<td style="text-align: center;">Prestamo</td>
<td style="text-align: center;">18000</td>
<td style="text-align: center;">En mora</td>
<td style="text-align: center;">2023-Q2</td>
</tr>
<tr>
<td style="text-align: center;">C005</td>
<td style="text-align: center;">Prestamo</td>
<td style="text-align: center;">22000</td>
<td style="text-align: center;">En mora</td>
<td style="text-align: center;">2023-Q4</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">dl_morosos</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;estado_mora&quot;</span><span class="p">)</span><span class="o">==</span><span class="s2">&quot;En mora&quot;</span><span class="p">)</span> <span class="c1">#(1)!</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="n">clientes_filtrados</span><span class="o">=</span> <span class="n">dl_morosos</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s2">&quot;cliente&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;monto&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;total_monto&quot;</span><span class="p">)</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    <span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;total_monto&quot;</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">13000.00</span><span class="p">)</span> <span class="c1">#(2)!</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="n">dl_morosos</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">clientes_filtrados</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;cliente&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span> <span class="c1">#(3)!</span>
</span></code></pre></div>
<ol>
<li>Primero obtenemos el DataFrame que contiene a todos los clientes en estado "En mora".</li>
<li>Del DataFrame obtenido, realizamos un <code>group_by</code> respecto a los clientes, se calcula la suma de todos los montos que tiene en "En mora" y a esa columna (<code>total_monto</code>) aplicamos un filtro donde se obtiene los que tienen una deuda mayor a $/. 13000.00</li>
<li>La tabla que se obtiene, le realizamos un <code>Inner Join</code> con nuestro DataFrame inicial, que contiene a todos los clientes morosos (<code>dl_morosos</code>), tomando como columna clave a <code>cliente</code>.</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align: center;">cliente</th>
<th style="text-align: center;">producto</th>
<th style="text-align: center;">monto</th>
<th style="text-align: center;">estado_mora</th>
<th style="text-align: center;">periodo</th>
<th style="text-align: center;">total_monto</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">str</td>
<td style="text-align: center;">str</td>
<td style="text-align: center;">i64</td>
<td style="text-align: center;">str</td>
<td style="text-align: center;">str</td>
<td style="text-align: center;">i64</td>
</tr>
<tr>
<td style="text-align: center;">C004</td>
<td style="text-align: center;">Prestamo</td>
<td style="text-align: center;">18000</td>
<td style="text-align: center;">En mora</td>
<td style="text-align: center;">2023-Q2</td>
<td style="text-align: center;">18000</td>
</tr>
<tr>
<td style="text-align: center;">C005</td>
<td style="text-align: center;">Prestamo</td>
<td style="text-align: center;">22000</td>
<td style="text-align: center;">En mora</td>
<td style="text-align: center;">2023-Q4</td>
<td style="text-align: center;">22000</td>
</tr>
</tbody>
</table>
</div>
<div class="tabbed-block">
<div class="language-sql highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">WITH</span><span class="w"> </span><span class="n">datos_agrupados</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">    </span><span class="k">SELECT</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">        </span><span class="n">cliente</span><span class="p">,</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">        </span><span class="n">producto</span><span class="p">,</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">        </span><span class="n">monto</span><span class="p">,</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">        </span><span class="n">estado_mora</span><span class="p">,</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">        </span><span class="n">periodo</span><span class="p">,</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">monto</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">                            </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">cliente</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">                        </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MontoMedio</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">historial_crediticio</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">estado_mora</span><span class="o">=</span><span class="s1">&#39;En mora&#39;</span><span class="w"> </span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="p">)</span><span class="w"> </span><span class="c1">--(1)!</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">datos_agrupados</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">Monto_Total</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">13000</span><span class="p">.</span><span class="mi">00</span><span class="p">;</span><span class="w"> </span><span class="c1">--(2)!</span>
</span></code></pre></div>
<ol>
<li>Mediante un <strong>CTE</strong> se obtiene una tabla que contiene la suma de los montos, agrupados por clientes, solo de los clientes que tiene como <code class="language-sql highlight"><span class="n">estado_mora</span><span class="o">=</span><span class="s1">&#39;En mora&#39;</span></code>.</li>
<li>Finalmente, se realiza un filtro para solo obtener las filas donde su <code class="language-sql highlight"><span class="n">Monto_Total</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">13000</span><span class="p">.</span><span class="mi">00</span></code></li>
</ol>
<table>
<thead>
<tr>
<th style="text-align: center;">cliente</th>
<th style="text-align: center;">producto</th>
<th style="text-align: center;">monto</th>
<th style="text-align: center;">estado_mora</th>
<th style="text-align: center;">periodo</th>
<th style="text-align: center;">Monto_Total</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">C004</td>
<td style="text-align: center;">Prestamo</td>
<td style="text-align: center;">18000.00</td>
<td style="text-align: center;">En mora</td>
<td style="text-align: center;">2023-Q2</td>
<td style="text-align: center;">18000.00</td>
</tr>
<tr>
<td style="text-align: center;">C005</td>
<td style="text-align: center;">Prestamo</td>
<td style="text-align: center;">22000.00</td>
<td style="text-align: center;">En mora</td>
<td style="text-align: center;">2023-Q4</td>
<td style="text-align: center;">22000.00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../2.%20Unpivot/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 2. Unpivot">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                2. Unpivot
              </div>
            </div>
          </a>
        
        
          
          <a href="../../2.%20Combining%20Data/1.%20Appending/" class="md-footer__link md-footer__link--next" aria-label="Next: 1. Appending">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                1. Appending
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Daryl CS
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://linkedin.com/in/darylics" target="_blank" rel="noopener" title="squidfunk on Mastodon" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.06 2.06 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065m1.782 13.019H3.555V9h3.564zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "content.footnote.tooltips"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>